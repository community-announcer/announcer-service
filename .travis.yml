language: go
go:
- '1.10'
sudo: required
services:
- docker
install:
- go get -u github.com/kardianos/govendor
- govendor sync
jobs:
  include:
    - stage: test
      script: go test
    - stage: deploy
      script:
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin registry.heroku.com
        - docker build -f Dockerfile -t registry.heroku.com/community-announcer/web .
        - docker push registry.heroku.com/community-announcer/web
    - stage: integration-test
      script: docker run -it --rm -v $(pwd)/blueprints:/blueprints --entrypoint dredd burakince/docker-dredd /blueprints/*.md https://community-announcer.herokuapp.com
